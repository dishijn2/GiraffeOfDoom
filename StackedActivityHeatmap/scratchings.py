testdata = [
["19/01/2017 21:58","-28.521"],
["19/01/2017 21:59","-27.42"],
["19/01/2017 22:00","-27.305"],
["19/01/2017 22:01","-27.245"],
["19/01/2017 22:02","-27.264"],
["19/01/2017 22:03","-27.269"],
["19/01/2017 22:04","-27.174"],
["19/01/2017 22:05","-27.173"],
["19/01/2017 22:06","-27.174"],
["19/01/2017 22:07","-27.226"],
["19/01/2017 22:08","-27.327"],
["19/01/2017 22:09","-27.356"],
["19/01/2017 22:10","-27.274"],
["19/01/2017 22:11","-27.247"],
["19/01/2017 22:12","-27.114"],
["19/01/2017 22:13","-27.059"],
["19/01/2017 22:14","-27.114"],
["19/01/2017 22:15","-27.095"],
["19/01/2017 22:16","-27.097"],
["19/01/2017 22:17","-27.12"],
["19/01/2017 22:18","-27.069"],
["19/01/2017 22:19","-27.131"],
["19/01/2017 22:20","-27.167"],
["19/01/2017 22:21","-27.13"],
["19/01/2017 22:22","-27.794"],
["19/01/2017 22:23","-28"],
["19/01/2017 22:24","-27.723"],
["19/01/2017 22:25","-26.843"],
["19/01/2017 22:26","-26.744"],
["19/01/2017 22:27","-26.66"],
["19/01/2017 22:28","-26.687"],
["19/01/2017 22:29","-26.644"],
["19/01/2017 22:30","-26.436"],
["19/01/2017 22:31","-26.267"],
["19/01/2017 22:32","-26.23"],
["19/01/2017 22:33","-26.33"],
["19/01/2017 22:34","-26.278"],
["19/01/2017 22:35","-26.126"],
["19/01/2017 22:36","-26.023"],
["19/01/2017 22:37","-25.972"],
["19/01/2017 22:38","-25.786"],
["19/01/2017 22:39","-25.926"],
["19/01/2017 22:40","-25.989"],
["19/01/2017 22:41","-26.134"],
["19/01/2017 22:42","-26.085"],
["19/01/2017 22:43","-26.041"],
["19/01/2017 22:44","-26.037"],
["19/01/2017 22:45","-25.942"],
["19/01/2017 22:46","-25.83"],
["19/01/2017 22:47","-25.843"],
["19/01/2017 22:48","-25.931"],
["19/01/2017 22:49","-25.941"],
["19/01/2017 22:50","-25.95"],
["19/01/2017 22:51","-25.978"],
["19/01/2017 22:52","-25.886"],
["19/01/2017 22:53","-25.579"],
["19/01/2017 22:54","-25.805"],
["19/01/2017 22:55","-25.78"],
["19/01/2017 22:56","-25.698"],
["19/01/2017 22:57","-25.703"],
["19/01/2017 22:58","-25.748"],
["19/01/2017 22:59","-25.771"],
["19/01/2017 23:00","-25.771"],
["19/01/2017 23:01","-25.684"],
["19/01/2017 23:02","-25.693"],
["19/01/2017 23:03","-25.646"],
["19/01/2017 23:04","-25.429"],
["19/01/2017 23:05","-25.293"],
["19/01/2017 23:06","-25.416"],
["19/01/2017 23:07","-25.391"],
["19/01/2017 23:08","-25.28"],
["19/01/2017 23:09","-25.131"],
["19/01/2017 23:10","-25.138"],
["19/01/2017 23:11","-25.152"],
["19/01/2017 23:12","-24.914"],
["19/01/2017 23:13","-24.829"],
["19/01/2017 23:14","-24.695"],
["19/01/2017 23:15","-24.594"],
["19/01/2017 23:16","-24.452"],
["19/01/2017 23:17","-24.215"],
["19/01/2017 23:18","-24.618"],
["19/01/2017 23:19","-24.695"],
["19/01/2017 23:20","-24.571"],
["19/01/2017 23:21","-24.225"],
["19/01/2017 23:22","-23.99"],
["19/01/2017 23:23","-24.15"],
["19/01/2017 23:24","-24.527"],
["19/01/2017 23:25","-24.55"],
["19/01/2017 23:26","-24.515"],
["19/01/2017 23:27","-24.522"],
["19/01/2017 23:28","-24.449"],
["19/01/2017 23:29","-24.438"],
["19/01/2017 23:30","-24.539"],
["19/01/2017 23:31","-24.551"],
["19/01/2017 23:32","-24.438"],
["19/01/2017 23:33","-24.276"],
["19/01/2017 23:34","-24.227"],
["19/01/2017 23:35","-24.458"],
["19/01/2017 23:36","-24.507"],
["19/01/2017 23:37","-24.167"],
["19/01/2017 23:38","-23.864"],
["19/01/2017 23:39","-23.853"],
["19/01/2017 23:40","-23.848"],
["19/01/2017 23:41","-24.008"],
["19/01/2017 23:42","-24.157"],
["19/01/2017 23:43","-24.18"],
["19/01/2017 23:44","-24.095"],
["19/01/2017 23:45","-24.162"],
["19/01/2017 23:46","-24.091"],
["19/01/2017 23:47","-24.3"],
["19/01/2017 23:48","-24.449"],
["19/01/2017 23:49","-24.43"],
["19/01/2017 23:50","-24.32"],
["19/01/2017 23:51","-24.229"],
["19/01/2017 23:52","-24.349"],
["19/01/2017 23:53","-24.182"],
["19/01/2017 23:54","-24.118"],
["19/01/2017 23:55","-24.081"],
["19/01/2017 23:56","-24.327"],
["19/01/2017 23:57","-24.473"],
["19/01/2017 23:58","-24.643"],
["19/01/2017 23:59","-24.63"],
["20/01/2017 0:00","-24.534"],
["20/01/2017 0:01","-24.412"],
["20/01/2017 0:02","-24.15"],
["20/01/2017 0:03","-24.16"],
["20/01/2017 0:04","-24.158"],
["20/01/2017 0:05","-24.2"],
["20/01/2017 0:06","-24.132"],
["20/01/2017 0:07","-23.892"],
["20/01/2017 0:08","-23.603"],
["20/01/2017 0:09","-23.611"],
["20/01/2017 0:10","-23.692"],
["20/01/2017 0:11","-23.296"],
["20/01/2017 0:12","-23.283"],
["20/01/2017 0:13","-23.709"],
["20/01/2017 0:14","-23.574"],
["20/01/2017 0:15","-23.402"],
["20/01/2017 0:16","-23.06"],
["20/01/2017 0:17","-22.782"],
["20/01/2017 0:18","-22.578"],
["20/01/2017 0:19","-22.562"],
["20/01/2017 0:20","-22.579"],
["20/01/2017 0:21","-22.522"],
["20/01/2017 0:22","-22.418"],
["20/01/2017 0:23","-22.377"],
["20/01/2017 0:24","-22.252"],
["20/01/2017 0:25","-22.13"],
["20/01/2017 0:26","-22.041"],
["20/01/2017 0:27","-21.967"],
["20/01/2017 0:28","-21.787"],
["20/01/2017 0:29","-21.619"],
["20/01/2017 0:30","-21.396"],
["20/01/2017 0:31","-21.341"],
["20/01/2017 0:32","-21.283"],
["20/01/2017 0:33","-21.172"],
["20/01/2017 0:34","-21.075"],
["20/01/2017 0:35","-20.918"],
["20/01/2017 0:36","-20.826"],
["20/01/2017 0:37","-20.638"],
["20/01/2017 0:38","-20.578"],
["20/01/2017 0:39","-20.538"],
["20/01/2017 0:40","-20.492"],
["20/01/2017 0:41","-20.153"],
["20/01/2017 0:42","-20.034"],
["20/01/2017 0:43","-19.886"],
["20/01/2017 0:44","-19.959"],
["20/01/2017 0:45","-20.053"],
["20/01/2017 0:46","-19.95"],
["20/01/2017 0:47","-19.847"],
["20/01/2017 0:48","-19.914"],
["20/01/2017 0:49","-19.83"],
["20/01/2017 0:50","-19.772"],
["20/01/2017 0:51","-19.691"],
["20/01/2017 0:52","-19.624"],
["20/01/2017 0:53","-19.461"],
["20/01/2017 0:54","-19.338"],
["20/01/2017 0:55","-19.217"],
["20/01/2017 0:56","-19.195"],
["20/01/2017 0:57","-19.051"],
["20/01/2017 0:58","-18.848"],
["20/01/2017 0:59","-18.677"],
["20/01/2017 1:00","-18.664"],
["20/01/2017 1:01","-18.581"],
["20/01/2017 1:02","-18.539"],
["20/01/2017 1:03","-18.487"],
["20/01/2017 1:04","-18.387"],
["20/01/2017 1:05","-17.894"],
["20/01/2017 1:06","-17.677"],
["20/01/2017 1:07","-17.542"],
["20/01/2017 1:08","-17.412"],
["20/01/2017 1:09","-17.602"],
["20/01/2017 1:10","-17.853"],
["20/01/2017 1:11","-17.687"],
["20/01/2017 1:12","-17.581"],
["20/01/2017 1:13","-17.547"],
["20/01/2017 1:14","-17.372"],
["20/01/2017 1:15","-17.198"],
["20/01/2017 1:16","-16.864"],
["20/01/2017 1:17","-16.46"],
["20/01/2017 1:18","-15.913"],
["20/01/2017 1:19","-15.263"],
["20/01/2017 1:20","-14.657"],
["20/01/2017 1:21","-14.313"],
["20/01/2017 1:22","-13.226"],
["20/01/2017 1:23","-12.216"],
["20/01/2017 1:24","-11.239"],
["20/01/2017 1:25","-10.926"],
["20/01/2017 1:26","-10.87"],
["20/01/2017 1:27","-10.756"],
["20/01/2017 1:28","-10.63"],
["20/01/2017 1:29","-10.509"],
["20/01/2017 1:30","-10.34"],
["20/01/2017 1:31","-10.263"],
["20/01/2017 1:32","-10.272"],
["20/01/2017 1:33","-10.318"],
["20/01/2017 1:34","-10.425"],
["20/01/2017 1:35","-10.3"],
["20/01/2017 1:36","-10.528"],
["20/01/2017 1:37","-10.96"],
["20/01/2017 1:38","-10.971"],
["20/01/2017 1:39","-10.763"],
["20/01/2017 1:40","-10.801"],
["20/01/2017 1:41","-10.74"],
["20/01/2017 1:42","-10.758"],
["20/01/2017 1:43","-10.858"],
["20/01/2017 1:44","-10.924"],
["20/01/2017 1:45","-10.922"],
["20/01/2017 1:46","-11.278"],
["20/01/2017 1:47","-11.51"],
["20/01/2017 1:48","-11.645"],
["20/01/2017 1:49","-11.503"],
["20/01/2017 1:50","-11.538"],
["20/01/2017 1:51","-11.465"],
["20/01/2017 1:52","-11.554"],
["20/01/2017 1:53","-11.57"],
["20/01/2017 1:54","-11.552"],
["20/01/2017 1:55","-11.487"],
["20/01/2017 1:56","-11.339"],
["20/01/2017 1:57","-11.28"],
["20/01/2017 1:58","-11.126"],
["20/01/2017 1:59","-11.01"],
["20/01/2017 2:00","-10.86"],
["20/01/2017 2:01","-10.752"],
["20/01/2017 2:02","-10.662"],
["20/01/2017 2:03","-10.552"],
["20/01/2017 2:04","-10.35"],
["20/01/2017 2:05","-10.297"],
["20/01/2017 2:06","-10.312"],
["20/01/2017 2:07","-10.27"],
["20/01/2017 2:08","-10.325"],
["20/01/2017 2:09","-10.26"],
["20/01/2017 2:10","-10.298"],
["20/01/2017 2:11","-10.233"],
["20/01/2017 2:12","-10.168"],
["20/01/2017 2:13","-10.179"],
["20/01/2017 2:14","-10.135"],
["20/01/2017 2:15","-10.102"],
["20/01/2017 2:16","-10.071"],
["20/01/2017 2:17","-10.108"],
["20/01/2017 2:18","-10.081"],
["20/01/2017 2:19","-10.025"],
["20/01/2017 2:20","-10.001"],
["20/01/2017 2:21","-9.94"],
["20/01/2017 2:22","-9.7169"],
["20/01/2017 2:23","-9.5496"],
["20/01/2017 2:24","-9.3892"],
["20/01/2017 2:25","-9.32"],
["20/01/2017 2:26","-9.1892"],
["20/01/2017 2:27","-9.1358"],
["20/01/2017 2:28","-9.0208"],
["20/01/2017 2:29","-8.8515"],
["20/01/2017 2:30","-8.7738"],
["20/01/2017 2:31","-8.7865"],
["20/01/2017 2:32","-8.718"],
["20/01/2017 2:33","-8.6004"],
["20/01/2017 2:34","-8.6904"],
["20/01/2017 2:35","-8.7169"],
["20/01/2017 2:36","-8.6772"],
["20/01/2017 2:37","-8.7815"],
["20/01/2017 2:38","-8.77"],
["20/01/2017 2:39","-8.5031"],
["20/01/2017 2:40","-8.3912"],
["20/01/2017 2:41","-8.4788"],
["20/01/2017 2:42","-8.6015"],
["20/01/2017 2:43","-8.6435"],
["20/01/2017 2:44","-8.514"],
["20/01/2017 2:45","-8.4227"],
["20/01/2017 2:46","-8.5077"],
["20/01/2017 2:47","-8.4981"],
["20/01/2017 2:48","-8.6092"],
["20/01/2017 2:49","-8.6115"],
["20/01/2017 2:50","-8.4885"],
["20/01/2017 2:51","-8.4342"],
["20/01/2017 2:52","-8.2696"],
["20/01/2017 2:53","-8.0684"],
["20/01/2017 2:54","-8.0023"],
["20/01/2017 2:55","-7.8304"],
["20/01/2017 2:56","-7.8"],
["20/01/2017 2:57","-8.0388"],
["20/01/2017 2:58","-8.2362"],
["20/01/2017 2:59","-8.2185"],
["20/01/2017 3:00","-8.2812"],
["20/01/2017 3:01","-8.3176"],
["20/01/2017 3:02","-8.5988"],
["20/01/2017 3:03","-8.8927"],
["20/01/2017 3:04","-8.8969"],
["20/01/2017 3:05","-8.9988"],
["20/01/2017 3:06","-9.2269"],
["20/01/2017 3:07","-9.195"],
["20/01/2017 3:08","-9.1354"],
["20/01/2017 3:09","-8.9528"],
["20/01/2017 3:10","-8.7038"],
["20/01/2017 3:11","-8.5219"],
["20/01/2017 3:12","-8.5342"],
["20/01/2017 3:13","-8.642"],
["20/01/2017 3:14","-8.4869"],
["20/01/2017 3:15","-8.3892"],
["20/01/2017 3:16","-8.3073"],
["20/01/2017 3:17","-8.3728"],
["20/01/2017 3:18","-8.3508"],
["20/01/2017 3:19","-8.2615"],
["20/01/2017 3:20","-8.1177"],
["20/01/2017 3:21","-7.798"],
["20/01/2017 3:22","-7.5731"],
["20/01/2017 3:23","-7.4273"],
["20/01/2017 3:24","-7.1948"],
["20/01/2017 3:25","-7.07"],
["20/01/2017 3:26","-6.7212"],
["20/01/2017 3:27","-6.3208"],
["20/01/2017 3:28","-5.9936"],
["20/01/2017 3:29","-5.8527"],
["20/01/2017 3:30","-5.6619"],
["20/01/2017 3:31","-5.3458"],
["20/01/2017 3:32","-5.0784"],
["20/01/2017 3:33","-5.0638"],
["20/01/2017 3:34","-4.9873"],
["20/01/2017 3:35","-4.85"],
["20/01/2017 3:36","-4.7388"],
["20/01/2017 3:37","-4.6781"],
["20/01/2017 3:38","-4.5154"],
["20/01/2017 3:39","-4.4312"],
["20/01/2017 3:40","-4.2973"],
["20/01/2017 3:41","-4.1862"],
["20/01/2017 3:42","-4.1888"],
["20/01/2017 3:43","-4.2144"],
["20/01/2017 3:44","-4.2458"],
["20/01/2017 3:45","-4.2673"],
["20/01/2017 3:46","-4.1664"],
["20/01/2017 3:47","-4.1077"],
["20/01/2017 3:48","-4.1177"],
["20/01/2017 3:49","-4.0915"],
["20/01/2017 3:50","-4.1344"],
["20/01/2017 3:51","-4.2485"],
["20/01/2017 3:52","-4.2181"],
["20/01/2017 3:53","-4.18"],
["20/01/2017 3:54","-4.1384"],
["20/01/2017 3:55","-4.0754"],
["20/01/2017 3:56","-4.0062"],
["20/01/2017 3:57","-3.9468"],
["20/01/2017 3:58","-4.0362"],
["20/01/2017 3:59","-4.0531"],
["20/01/2017 4:00","-4.1077"],
["20/01/2017 4:01","-4.16"],
["20/01/2017 4:02","-4.1154"],
["20/01/2017 4:03","-3.9304"],
["20/01/2017 4:04","-3.8342"],
["20/01/2017 4:05","-3.8873"],
["20/01/2017 4:06","-3.9592"],
["20/01/2017 4:07","-3.8931"],
["20/01/2017 4:08","-3.8551"],
["20/01/2017 4:09","-3.8001"],
["20/01/2017 4:10","-3.8577"],
["20/01/2017 4:11","-3.8773"],
["20/01/2017 4:12","-3.9385"],
["20/01/2017 4:13","-4.0027"],
["20/01/2017 4:14","-3.9196"],
["20/01/2017 4:15","-3.9326"],
["20/01/2017 4:16","-3.8938"],
["20/01/2017 4:17","-3.7246"],
["20/01/2017 4:18","-3.54"],
["20/01/2017 4:19","-3.5312"],
["20/01/2017 4:20","-3.5708"],
["20/01/2017 4:21","-3.4794"],
["20/01/2017 4:22","-3.289"],
["20/01/2017 4:23","-3.2138"],
["20/01/2017 4:24","-3.2347"],
["20/01/2017 4:25","-3.3043"],
["20/01/2017 4:26","-3.1978"],
["20/01/2017 4:27","-3.2502"],
["20/01/2017 4:28","-3.2207"],
["20/01/2017 4:29","-3.1775"],
["20/01/2017 4:30","-3.1708"],
["20/01/2017 4:31","-3.1107"],
["20/01/2017 4:32","-3.0668"],
["20/01/2017 4:33","-3.0622"],
["20/01/2017 4:34","-3.507"],
["20/01/2017 4:35","-3.5735"],
["20/01/2017 4:36","-3.6447"],
["20/01/2017 4:37","-3.7212"],
["20/01/2017 4:38","-3.6881"],
["20/01/2017 4:39","-3.7159"],
["20/01/2017 4:40","-3.5777"],
["20/01/2017 4:41","-3.4281"],
["20/01/2017 4:42","-3.3633"],
["20/01/2017 4:43","-3.1601"],
["20/01/2017 4:44","-3.1902"],
["20/01/2017 4:45","-3.1258"],
["20/01/2017 4:46","-2.9929"],
["20/01/2017 4:47","-2.8774"],
["20/01/2017 4:48","-2.766"],
["20/01/2017 4:49","-2.7912"],
["20/01/2017 4:50","-2.8422"],
["20/01/2017 4:51","-2.8346"],
["20/01/2017 4:52","-2.9005"],
["20/01/2017 4:53","-2.869"],
["20/01/2017 4:54","-2.8924"],
["20/01/2017 4:55","-2.9592"],
["20/01/2017 4:56","-3.1516"],
["20/01/2017 4:57","-3.3426"],
["20/01/2017 4:58","-3.4486"],
["20/01/2017 4:59","-3.5021"],
["20/01/2017 5:00","-3.6159"],
["20/01/2017 5:01","-3.5982"],
["20/01/2017 5:02","-3.5499"],
["20/01/2017 5:03","-3.5077"],
["20/01/2017 5:04","-3.4954"],
["20/01/2017 5:05","-3.5317"],
["20/01/2017 5:06","-3.5103"],
["20/01/2017 5:07","-3.4766"],
["20/01/2017 5:08","-3.4789"],
["20/01/2017 5:09","-3.4838"],
["20/01/2017 5:10","-3.3615"],
["20/01/2017 5:11","-3.3511"],
["20/01/2017 5:12","-3.2683"],
["20/01/2017 5:13","-3.3882"],
["20/01/2017 5:14","-3.359"],
["20/01/2017 5:15","-3.2123"],
["20/01/2017 5:16","-3.2059"],
["20/01/2017 5:17","-3.1868"],
["20/01/2017 5:18","-3.1818"],
["20/01/2017 5:19","-3.2016"],
["20/01/2017 5:20","-3.0129"],
["20/01/2017 5:21","-3.0584"],
["20/01/2017 5:22","-3.0219"],
["20/01/2017 5:23","-3.0557"],
["20/01/2017 5:24","-3.0385"],
["20/01/2017 5:25","-3.0535"],
["20/01/2017 5:26","-3.0907"],
["20/01/2017 5:27","-3.0418"],
["20/01/2017 5:28","-2.9863"],
["20/01/2017 5:29","-3.0175"],
["20/01/2017 5:30","-3.068"],
["20/01/2017 5:31","-3.1771"],
["20/01/2017 5:32","-3.2949"],
["20/01/2017 5:33","-3.2312"],
["20/01/2017 5:34","-3.0178"],
["20/01/2017 5:35","-2.8989"],
["20/01/2017 5:36","-2.7609"],
["20/01/2017 5:37","-2.6178"],
["20/01/2017 5:38","-2.6216"],
["20/01/2017 5:39","-2.6698"],
["20/01/2017 5:40","-2.65"],
["20/01/2017 5:41","-2.6533"],
["20/01/2017 5:42","-2.6274"],
["20/01/2017 5:43","-2.651"],
["20/01/2017 5:44","-2.8379"],
["20/01/2017 5:45","-2.9598"],
["20/01/2017 5:46","-2.9628"],
["20/01/2017 5:47","-2.9528"],
["20/01/2017 5:48","-2.9034"],
["20/01/2017 5:49","-2.864"],
["20/01/2017 5:50","-2.7431"],
["20/01/2017 5:51","-3.1522"],
["20/01/2017 5:52","-2.8754"],
["20/01/2017 5:53","-2.692"],
["20/01/2017 5:54","-2.6534"],
["20/01/2017 5:55","-2.6353"],
["20/01/2017 5:56","-2.6636"],
["20/01/2017 5:57","-2.7043"],
["20/01/2017 5:58","-2.7424"],
["20/01/2017 5:59","-2.7572"],
["20/01/2017 6:00","-2.7185"],
["20/01/2017 6:01","-2.6649"],
["20/01/2017 6:02","-2.641"],
["20/01/2017 6:03","-2.5246"],
["20/01/2017 6:04","-2.4577"],
["20/01/2017 6:05","-2.4136"],
["20/01/2017 6:06","-2.4175"],
["20/01/2017 6:07","-2.4887"],
["20/01/2017 6:08","-2.5735"]
]


import math
from decimal import Decimal, getcontext
from datetime import datetime
from time import mktime

# FUNCTION DEFINITION
# bindata will take an array, each element is (unixtime, datavalue). It will parse thru the array and provide the average
# datavalue for the bin, provided there are enough datavalues per bin. the function returns the binned data, most recent
# at the front/top. If there are gaps or insufficiencies in data, there will be blanks
def bindata(rawdata, binsizeseconds, mincount):
    # init the return array
    bindata = []

    # reverse the raw data so most recent is at the top
    rawdata.reverse()

    # Find the begin and end times for the data
    nowsplit = rawdata[0].split(",")
    nowtime = nowsplit[0]
    startsplit = rawdata[len(rawdata) - 1].split(",")
    starttime = startsplit[0]

    # populate bindata with the required timeslots
    for i in range(nowtime, starttime, -1 * binsizeseconds):
        bindata.append(i)

    for i in range(0, len(bindata) - 1):
        pass


# #################################################################################
# Calculate the differences
# This function will create an array of differences. each element is (unixtime, datavalue)
# Big gaps in time will cause either a BIG jump in datavalues (which will get filtered out)
# or small gaps, which if the  trend os flat, are to be expected. so should not add
# significant error.
# #################################################################################
def create_diffs(readings):
    diffsarray = []
    # This is a value for spikes that are false, or artificially caused
    NOISE_SPIKE = 3

    # If the array is of sufficient size...
    if len(readings) > 2:
        for i in range(1, len(readings)):
            # get the 2 data readings we need to calculate the differences
            nowdata = readings[i]
            nowdata = nowdata.split(",")
            datetime = nowdata[0]
            data_now = nowdata[1]

            olddata = readings[i - 1]
            olddata = olddata.split(",")
            data_old = olddata[1]

            # Calculate the difference figure we need
            diffdata = data_now - data_old

            # if the difference is abnormally large, then make it a zero.
            if math.sqrt(math.pow(diffdata, 2)) > NOISE_SPIKE:
                diffdata = 0

            dp = datetime + "," + diffdata

            diffsarray.append(dp)

    else:
        dp = ("0000-00-00 00:00:00", 0)
        diffsarray.append(dp)

    return diffsarray


# ##################################################
# Convert timestamps in array to Unix time
# ##################################################
def utc2unix(arraylist):
    print("Converting time to UNIX time...")
    # set date time format for strptime()
    # dateformat = "%Y-%m-%d %H:%M:%S.%f"
    dateformat = "%Y-%m-%d %H:%M"
    workingarray = []

    # convert array data times to unix time
    workingarray = []
    for item in arraylist:
    # try:
        print(item)
        datasplit = item.split(",")

        newdatetime = datetime.strptime(datasplit[0],dateformat)
        # convert to Unix time (Seconds)
        newdatetime = mktime(newdatetime.timetuple())

        datastring = str(newdatetime) + "," + str(datasplit[1])
        workingarray.append(datastring)
    # except:
    #     print("Problem with this entry: " + str(item))

    return workingarray


testdata = utc2unix(testdata)
testdata = create_diffs(testdata)
print(testdata)